function out = base(dr,st)
%
% base.m
%
% Model exported on Jul 8 2021, 15:55 by COMSOL 5.4.0.295.

import com.comsol.model.*
import com.comsol.model.util.*

out = 0;

model = ModelUtil.create('Model');

model.modelPath('C:\Users\Alpha\Documents\andy\chiral_models_comsol');

model.modelNode.create('comp1', true);

model.geom.create('geom1', 3);
model.geom('geom1').model('comp1');

model.mesh.create('mesh1', 'geom1');

model.physics.create('ewfd', 'ElectromagneticWavesFrequencyDomain', 'geom1');
model.physics('ewfd').model('comp1');
model.physics.create('ewfd2', 'ElectromagneticWavesFrequencyDomain', 'geom1');
model.physics('ewfd2').model('comp1');

model.study.create('std1');
model.study('std1').setGenConv(true);
model.study('std1').create('freq', 'Frequency');
model.study('std1').feature('freq').set('solnum', 'auto');
model.study('std1').feature('freq').set('notsolnum', 'auto');
model.study('std1').feature('freq').set('ngen', '5');
model.study('std1').feature('freq').activate('ewfd', true);
model.study('std1').feature('freq').activate('ewfd2', true);

model.param.set('lambda', '560[nm]');
model.param.descr('lambda', '');
model.param.set('frequency', 'c_const/lambda');
model.param.descr('frequency', '');
model.param.set('theta', '0[rad]');
model.param.descr('theta', '');
model.param.set('I0', '1[W]/(blc*blc)');
model.param.descr('I0', '');
model.param.set('E0', 'sqrt(2*I0*Z0_const)');
model.param.descr('E0', '');
model.param.set('H0', 'E0/c_const');
model.param.descr('H0', '');
model.param.set('C0', 'epsilon0_const*pi*frequency*E0*H0');
model.param.descr('C0', '');
model.param.set('n_medium', '1');
model.param.descr('n_medium', '');
model.param.set('blc', '560[nm]');
model.param.descr('blc', '');
model.param.set('wb', 'blc/21');
model.param.descr('wb', '');
model.param.set('hb', '20[nm]');
model.param.descr('hb', '');

model.variable.create('var1');
model.variable('var1').model('comp1');

model.geom('geom1').run;

model.variable('var1').set('dotproduct_RCP', 'conj(ewfd2.Ex)*(ewfd2.Bx)+conj(ewfd2.Ey)*(ewfd2.By)+conj(ewfd2.Ez)*(ewfd2.Bz)');
model.variable('var1').descr('dotproduct_RCP', '');
model.variable('var1').set('dotproduct_LCP', 'conj(ewfd.Ex)*(ewfd.Bx)+conj(ewfd.Ey)*(ewfd.By)+conj(ewfd.Ez)*(ewfd.Bz)');
model.variable('var1').descr('dotproduct_LCP', '');
model.variable('var1').set('dotproduct_CPL', 'conj(ewfd.Ex+ewfd2.Ex)*(ewfd.Bx+ewfd2.Bx)+conj(ewfd.Ey+ewfd2.Ey)*(ewfd.By+ewfd2.By)+conj(ewfd.Ez+ewfd2.Ez)*(ewfd.Bz+ewfd2.Bz)');
model.variable('var1').descr('dotproduct_CPL', '');
model.variable('var1').set('C_RCP', 'epsilon0_const*pi*frequency*imag(dotproduct_RCP)');
model.variable('var1').descr('C_RCP', '');
model.variable('var1').set('C_LCP', 'epsilon0_const*pi*frequency*imag(dotproduct_LCP)');
model.variable('var1').descr('C_LCP', '');
model.variable('var1').set('C_CPL', 'epsilon0_const*pi*frequency*imag(dotproduct_CPL)');
model.variable('var1').descr('C_CPL', '');

model.geom('geom1').create('blk1', 'Block');
model.geom('geom1').feature('blk1').set('size', {'blc' 'blc' 'blc*2'});
model.geom('geom1').feature('blk1').set('base', 'center');
model.geom('geom1').run('blk1');
model.geom('geom1').create('blk2', 'Block');
model.geom('geom1').feature('blk2').set('size', {'blc' 'blc' 'blc*3'});
model.geom('geom1').feature('blk2').set('base', 'center');
model.geom('geom1').runPre('fin');


model.geom('geom1').create('pt1', 'Point');
model.geom('geom1').feature('pt1').set('p', {'0' '0' '0'});
model.geom('geom1').create('pt2', 'Point');
model.geom('geom1').feature('pt2').set('p', {'0' '0' 'hb'});
model.geom('geom1').create('pt3', 'Point');
model.geom('geom1').feature('pt3').set('p', {'0' '0' '-hb'});
model.geom('geom1').create('pt4', 'Point');
model.geom('geom1').feature('pt4').set('p', {'0' '0' '2*hb'});
model.geom('geom1').create('pt5', 'Point');
model.geom('geom1').feature('pt5').set('p', {'0' '0' '-2*hb'});
model.geom('geom1').create('pt6', 'Point');
model.geom('geom1').feature('pt6').set('p', {'0' '0' '3*hb'});
model.geom('geom1').create('pt7', 'Point');
model.geom('geom1').feature('pt7').set('p', {'0' '0' '-3*hb'});
model.geom('geom1').runPre('fin');

model.view('view1').set('transparency', true);

model.coordSystem.create('pml1', 'geom1', 'PML');

model.geom('geom1').run;

model.coordSystem('pml1').selection.set([1 3]);

model.material.create('mat1', 'Common', 'comp1');
model.material('mat1').propertyGroup.create('RefractiveIndex', 'Refractive index');
model.material('mat1').propertyGroup('RefractiveIndex').func.create('int1', 'Interpolation');
model.material('mat1').propertyGroup('RefractiveIndex').func.create('int2', 'Interpolation');
model.material('mat1').label(['Au (Gold) (Raki' native2unicode(hex2dec({'00' 'c4'}), 'unicode')  native2unicode(hex2dec({'20' '21'}), 'unicode') ' et al. 1998: Brendel-Bormann model; n,k 0.248-6.20 ' native2unicode(hex2dec({'00' 'b5'}), 'unicode') 'm)']);
model.material('mat1').set('groups', {'inorganic' 'Inorganic Materials'; 'au_gold' 'Au - Gold'; 'models_and_simulations' 'Models and simulations'});
model.material('mat1').propertyGroup('RefractiveIndex').func('int1').label('Refractive index');
model.material('mat1').propertyGroup('RefractiveIndex').func('int1').set('funcname', 'n_interp');
model.material('mat1').propertyGroup('RefractiveIndex').func('int1').set('table', {'2.4796999999999996E-7' '1.4943';  ...
'2.5201E-7' '1.5158';  ...
'2.5612E-7' '1.5382';  ...
'2.6029999999999997E-7' '1.5611';  ...
'2.6454E-7' '1.5844';  ...
'2.6886E-7' '1.6078';  ...
'2.7324E-7' '1.6306';  ...
'2.777E-7' '1.6527';  ...
'2.8222E-7' '1.6733';  ...
'2.8683E-7' '1.6921';  ...
'2.915E-7' '1.7085';  ...
'2.9626000000000003E-7' '1.722';  ...
'3.0109E-7' '1.7322';  ...
'3.0599999999999996E-7' '1.7387';  ...
'3.1098999999999995E-7' '1.7411';  ...
'3.1606E-7' '1.7391';  ...
'3.2121E-7' '1.7327';  ...
'3.2645E-7' '1.7219';  ...
'3.3177E-7' '1.7071';  ...
'3.3717999999999995E-7' '1.6887';  ...
'3.4268E-7' '1.6677';  ...
'3.4827000000000003E-7' '1.6452';  ...
'3.5394999999999996E-7' '1.6224';  ...
'3.5971999999999994E-7' '1.6006';  ...
'3.6559000000000003E-7' '1.581';  ...
'3.7154999999999996E-7' '1.5645';  ...
'3.7761E-7' '1.5515';  ...
'3.8377E-7' '1.5419';  ...
'3.9001999999999994E-7' '1.5351';  ...
'3.9638E-7' '1.5301';  ...
'4.0285E-7' '1.5255';  ...
'4.0941999999999997E-7' '1.5196';  ...
'4.1609E-7' '1.5107';  ...
'4.2287999999999993E-7' '1.4971';  ...
'4.2976999999999996E-7' '1.4771';  ...
'4.3677999999999997E-7' '1.4493';  ...
'4.439E-7' '1.4126';  ...
'4.5113999999999995E-7' '1.3661';  ...
'4.585E-7' '1.3095';  ...
'4.6598E-7' '1.2427';  ...
'4.7358E-7' '1.1664';  ...
'4.813E-7' '1.0821';  ...
'4.891499999999999E-7' '0.99182';  ...
'4.9712E-7' '0.89849';  ...
'5.052299999999999E-7' '0.80543';  ...
'5.1347E-7' '0.7159';  ...
'5.2184E-7' '0.6326';  ...
'5.303499999999999E-7' '0.55731';  ...
'5.39E-7' '0.49085';  ...
'5.4779E-7' '0.43326';  ...
'5.567199999999999E-7' '0.38405';  ...
'5.657999999999999E-7' '0.34242';  ...
'5.7503E-7' '0.30751';  ...
'5.844E-7' '0.27843';  ...
'5.939299999999999E-7' '0.25437';  ...
'6.036200000000001E-7' '0.23457';  ...
'6.1346E-7' '0.21841';  ...
'6.2346E-7' '0.20533';  ...
'6.3363E-7' '0.19487';  ...
'6.4396E-7' '0.18664';  ...
'6.5446E-7' '0.1803';  ...
'6.651399999999999E-7' '0.17558';  ...
'6.759799999999999E-7' '0.17227';  ...
'6.8701E-7' '0.17016';  ...
'6.9821E-7' '0.16911';  ...
'7.0959E-7' '0.16897';  ...
'7.2117E-7' '0.16966';  ...
'7.3292E-7' '0.17107';  ...
'7.448799999999999E-7' '0.17313';  ...
'7.5702E-7' '0.17577';  ...
'7.6937E-7' '0.17895';  ...
'7.819099999999999E-7' '0.18262';  ...
'7.9466E-7' '0.18675';  ...
'8.076199999999999E-7' '0.19129';  ...
'8.2079E-7' '0.19621';  ...
'8.3418E-7' '0.20151';  ...
'8.477799999999999E-7' '0.20715';  ...
'8.616E-7' '0.21311';  ...
'8.7565E-7' '0.21938';  ...
'8.899299999999999E-7' '0.22594';  ...
'9.0445E-7' '0.23278';  ...
'9.1919E-7' '0.23989';  ...
'9.3418E-7' '0.24725';  ...
'9.4942E-7' '0.25486';  ...
'9.648999999999999E-7' '0.26271';  ...
'9.8063E-7' '0.27079';  ...
'9.966199999999998E-7' '0.27909';  ...
'1.0128999999999999E-6' '0.28761';  ...
'1.0294E-6' '0.29634';  ...
'1.0462E-6' '0.30528';  ...
'1.0631999999999998E-6' '0.31442';  ...
'1.0805999999999999E-6' '0.32376';  ...
'1.0982E-6' '0.33329';  ...
'1.1161E-6' '0.34302';  ...
'1.1343E-6' '0.35293';  ...
'1.1528E-6' '0.36304';  ...
'1.1716E-6' '0.37334';  ...
'1.1907E-6' '0.38382';  ...
'1.2100999999999999E-6' '0.39449';  ...
'1.2298999999999999E-6' '0.40535';  ...
'1.2498999999999999E-6' '0.41641';  ...
'1.2703E-6' '0.42765';  ...
'1.2909999999999998E-6' '0.43909';  ...
'1.3121E-6' '0.45072';  ...
'1.3334999999999998E-6' '0.46256';  ...
'1.3552E-6' '0.47459';  ...
'1.3773E-6' '0.48684';  ...
'1.3998E-6' '0.4993';  ...
'1.4226E-6' '0.51198';  ...
'1.4458E-6' '0.52488';  ...
'1.4694E-6' '0.53801';  ...
'1.4933E-6' '0.55138';  ...
'1.5176999999999999E-6' '0.56499';  ...
'1.5423999999999998E-6' '0.57885';  ...
'1.5676E-6' '0.59297';  ...
'1.5930999999999998E-6' '0.60736';  ...
'1.6190999999999999E-6' '0.62203';  ...
'1.6455E-6' '0.63699';  ...
'1.6722999999999999E-6' '0.65224';  ...
'1.6996E-6' '0.6678';  ...
'1.7273E-6' '0.68368';  ...
'1.7555E-6' '0.69989';  ...
'1.7841E-6' '0.71645';  ...
'1.8131999999999999E-6' '0.73336';  ...
'1.8428E-6' '0.75065';  ...
'1.8727999999999999E-6' '0.76831';  ...
'1.9033999999999999E-6' '0.78638';  ...
'1.9343999999999996E-6' '0.80486';  ...
'1.966E-6' '0.82377';  ...
'1.9979999999999998E-6' '0.84313';  ...
'2.0306E-6' '0.86294';  ...
'2.0637E-6' '0.88324';  ...
'2.0974E-6' '0.90404';  ...
'2.1316E-6' '0.92535';  ...
'2.1663E-6' '0.9472';  ...
'2.2016E-6' '0.96961';  ...
'2.2374999999999998E-6' '0.99259';  ...
'2.2739999999999997E-6' '1.0162';  ...
'2.3111E-6' '1.0404';  ...
'2.3488000000000003E-6' '1.0652';  ...
'2.3871E-6' '1.0907';  ...
'2.426E-6' '1.1169';  ...
'2.4655999999999997E-6' '1.1438';  ...
'2.5058E-6' '1.1715';  ...
'2.5466999999999997E-6' '1.1999';  ...
'2.5882E-6' '1.2291';  ...
'2.6304E-6' '1.2592';  ...
'2.6732999999999995E-6' '1.2901';  ...
'2.7168999999999998E-6' '1.3219';  ...
'2.7612E-6' '1.3545';  ...
'2.8062E-6' '1.3882';  ...
'2.8519999999999995E-6' '1.4228';  ...
'2.8985E-6' '1.4584';  ...
'2.9457E-6' '1.4951';  ...
'2.9937999999999996E-6' '1.5328';  ...
'3.0426E-6' '1.5717';  ...
'3.0922E-6' '1.6117';  ...
'3.1425999999999998E-6' '1.6529';  ...
'3.1939E-6' '1.6954';  ...
'3.246E-6' '1.7391';  ...
'3.2989E-6' '1.7842';  ...
'3.3526999999999997E-6' '1.8306';  ...
'3.4073999999999998E-6' '1.8784';  ...
'3.4629E-6' '1.9277';  ...
'3.5194E-6' '1.9785';  ...
'3.5767999999999998E-6' '2.0308';  ...
'3.6350999999999997E-6' '2.0847';  ...
'3.6943999999999997E-6' '2.1403';  ...
'3.7545999999999996E-6' '2.1976';  ...
'3.8159E-6' '2.2566';  ...
'3.878099999999999E-6' '2.3175';  ...
'3.9413E-6' '2.3802';  ...
'4.0056E-6' '2.4449';  ...
'4.0708999999999994E-6' '2.5116';  ...
'4.137299999999999E-6' '2.5803';  ...
'4.204799999999999E-6' '2.6511';  ...
'4.273299999999999E-6' '2.7242';  ...
'4.343E-6' '2.7995';  ...
'4.4138E-6' '2.8771';  ...
'4.4858E-6' '2.9572';  ...
'4.5589000000000005E-6' '3.0397';  ...
'4.6333E-6' '3.1247';  ...
'4.7088E-6' '3.2124';  ...
'4.7855999999999995E-6' '3.3028';  ...
'4.8637E-6' '3.396';  ...
'4.942999999999999E-6' '3.4921';  ...
'5.0236E-6' '3.5911';  ...
'5.1055E-6' '3.6932';  ...
'5.188799999999999E-6' '3.7985';  ...
'5.273399999999999E-6' '3.9069';  ...
'5.3594E-6' '4.0187';  ...
'5.446799999999999E-6' '4.134';  ...
'5.535599999999999E-6' '4.2528';  ...
'5.6257999999999996E-6' '4.3752';  ...
'5.7176E-6' '4.5013';  ...
'5.8108E-6' '4.6314';  ...
'5.9056E-6' '4.7653';  ...
'6.0019E-6' '4.9034';  ...
'6.0997E-6' '5.0456';  ...
'6.1992E-6' '5.1922'});
model.material('mat1').propertyGroup('RefractiveIndex').func('int1').set('interp', 'piecewisecubic');
model.material('mat1').propertyGroup('RefractiveIndex').func('int1').set('argunit', 'm');
model.material('mat1').propertyGroup('RefractiveIndex').func('int1').set('fununit', '1');
model.material('mat1').propertyGroup('RefractiveIndex').func('int2').label('Refractive index, imaginary part');
model.material('mat1').propertyGroup('RefractiveIndex').func('int2').set('funcname', 'k_interp');
model.material('mat1').propertyGroup('RefractiveIndex').func('int2').set('table', {'2.4796999999999996E-7' '1.9575';  ...
'2.5201E-7' '1.9594';  ...
'2.5612E-7' '1.9605';  ...
'2.6029999999999997E-7' '1.9604';  ...
'2.6454E-7' '1.9587';  ...
'2.6886E-7' '1.9551';  ...
'2.7324E-7' '1.9494';  ...
'2.777E-7' '1.9414';  ...
'2.8222E-7' '1.9312';  ...
'2.8683E-7' '1.9188';  ...
'2.915E-7' '1.9042';  ...
'2.9626000000000003E-7' '1.8879';  ...
'3.0109E-7' '1.87';  ...
'3.0599999999999996E-7' '1.8512';  ...
'3.1098999999999995E-7' '1.8319';  ...
'3.1606E-7' '1.8128';  ...
'3.2121E-7' '1.7946';  ...
'3.2645E-7' '1.7784';  ...
'3.3177E-7' '1.7648';  ...
'3.3717999999999995E-7' '1.7548';  ...
'3.4268E-7' '1.749';  ...
'3.4827000000000003E-7' '1.7479';  ...
'3.5394999999999996E-7' '1.7516';  ...
'3.5971999999999994E-7' '1.7597';  ...
'3.6559000000000003E-7' '1.7714';  ...
'3.7154999999999996E-7' '1.7856';  ...
'3.7761E-7' '1.8007';  ...
'3.8377E-7' '1.8152';  ...
'3.9001999999999994E-7' '1.8276';  ...
'3.9638E-7' '1.8366';  ...
'4.0285E-7' '1.8413';  ...
'4.0941999999999997E-7' '1.8411';  ...
'4.1609E-7' '1.8362';  ...
'4.2287999999999993E-7' '1.8268';  ...
'4.2976999999999996E-7' '1.814';  ...
'4.3677999999999997E-7' '1.7988';  ...
'4.439E-7' '1.7829';  ...
'4.5113999999999995E-7' '1.7681';  ...
'4.585E-7' '1.7567';  ...
'4.6598E-7' '1.7509';  ...
'4.7358E-7' '1.7532';  ...
'4.813E-7' '1.7661';  ...
'4.891499999999999E-7' '1.7916';  ...
'4.9712E-7' '1.8312';  ...
'5.052299999999999E-7' '1.8852';  ...
'5.1347E-7' '1.953';  ...
'5.2184E-7' '2.0328';  ...
'5.303499999999999E-7' '2.1222';  ...
'5.39E-7' '2.2188';  ...
'5.4779E-7' '2.3201';  ...
'5.567199999999999E-7' '2.4245';  ...
'5.657999999999999E-7' '2.5305';  ...
'5.7503E-7' '2.637';  ...
'5.844E-7' '2.7434';  ...
'5.939299999999999E-7' '2.8493';  ...
'6.036200000000001E-7' '2.9545';  ...
'6.1346E-7' '3.0587';  ...
'6.2346E-7' '3.1621';  ...
'6.3363E-7' '3.2645';  ...
'6.4396E-7' '3.3662';  ...
'6.5446E-7' '3.4671';  ...
'6.651399999999999E-7' '3.5675';  ...
'6.759799999999999E-7' '3.6674';  ...
'6.8701E-7' '3.7669';  ...
'6.9821E-7' '3.8661';  ...
'7.0959E-7' '3.9653';  ...
'7.2117E-7' '4.0644';  ...
'7.3292E-7' '4.1635';  ...
'7.448799999999999E-7' '4.2629';  ...
'7.5702E-7' '4.3625';  ...
'7.6937E-7' '4.4624';  ...
'7.819099999999999E-7' '4.5627';  ...
'7.9466E-7' '4.6635';  ...
'8.076199999999999E-7' '4.7649';  ...
'8.2079E-7' '4.8669';  ...
'8.3418E-7' '4.9695';  ...
'8.477799999999999E-7' '5.0729';  ...
'8.616E-7' '5.177';  ...
'8.7565E-7' '5.282';  ...
'8.899299999999999E-7' '5.3878';  ...
'9.0445E-7' '5.4946';  ...
'9.1919E-7' '5.6024';  ...
'9.3418E-7' '5.7111';  ...
'9.4942E-7' '5.821';  ...
'9.648999999999999E-7' '5.9319';  ...
'9.8063E-7' '6.044';  ...
'9.966199999999998E-7' '6.1573';  ...
'1.0128999999999999E-6' '6.2718';  ...
'1.0294E-6' '6.3875';  ...
'1.0462E-6' '6.5046';  ...
'1.0631999999999998E-6' '6.6231';  ...
'1.0805999999999999E-6' '6.7429';  ...
'1.0982E-6' '6.8642';  ...
'1.1161E-6' '6.9869';  ...
'1.1343E-6' '7.1112';  ...
'1.1528E-6' '7.237';  ...
'1.1716E-6' '7.3644';  ...
'1.1907E-6' '7.4935';  ...
'1.2100999999999999E-6' '7.6242';  ...
'1.2298999999999999E-6' '7.7566';  ...
'1.2498999999999999E-6' '7.8908';  ...
'1.2703E-6' '8.0268';  ...
'1.2909999999999998E-6' '8.1646';  ...
'1.3121E-6' '8.3044';  ...
'1.3334999999999998E-6' '8.446';  ...
'1.3552E-6' '8.5896';  ...
'1.3773E-6' '8.7353';  ...
'1.3998E-6' '8.8829';  ...
'1.4226E-6' '9.0327';  ...
'1.4458E-6' '9.1847';  ...
'1.4694E-6' '9.3388';  ...
'1.4933E-6' '9.4951';  ...
'1.5176999999999999E-6' '9.6538';  ...
'1.5423999999999998E-6' '9.8147';  ...
'1.5676E-6' '9.978';  ...
'1.5930999999999998E-6' '10.144';  ...
'1.6190999999999999E-6' '10.312';  ...
'1.6455E-6' '10.483';  ...
'1.6722999999999999E-6' '10.656';  ...
'1.6996E-6' '10.832';  ...
'1.7273E-6' '11.01';  ...
'1.7555E-6' '11.192';  ...
'1.7841E-6' '11.376';  ...
'1.8131999999999999E-6' '11.563';  ...
'1.8428E-6' '11.752';  ...
'1.8727999999999999E-6' '11.945';  ...
'1.9033999999999999E-6' '12.14';  ...
'1.9343999999999996E-6' '12.339';  ...
'1.966E-6' '12.541';  ...
'1.9979999999999998E-6' '12.745';  ...
'2.0306E-6' '12.953';  ...
'2.0637E-6' '13.164';  ...
'2.0974E-6' '13.379';  ...
'2.1316E-6' '13.597';  ...
'2.1663E-6' '13.818';  ...
'2.2016E-6' '14.042';  ...
'2.2374999999999998E-6' '14.271';  ...
'2.2739999999999997E-6' '14.502';  ...
'2.3111E-6' '14.738';  ...
'2.3488000000000003E-6' '14.977';  ...
'2.3871E-6' '15.219';  ...
'2.426E-6' '15.466';  ...
'2.4655999999999997E-6' '15.717';  ...
'2.5058E-6' '15.971';  ...
'2.5466999999999997E-6' '16.229';  ...
'2.5882E-6' '16.492';  ...
'2.6304E-6' '16.758';  ...
'2.6732999999999995E-6' '17.029';  ...
'2.7168999999999998E-6' '17.304';  ...
'2.7612E-6' '17.584';  ...
'2.8062E-6' '17.867';  ...
'2.8519999999999995E-6' '18.156';  ...
'2.8985E-6' '18.448';  ...
'2.9457E-6' '18.746';  ...
'2.9937999999999996E-6' '19.048';  ...
'3.0426E-6' '19.354';  ...
'3.0922E-6' '19.666';  ...
'3.1425999999999998E-6' '19.982';  ...
'3.1939E-6' '20.304';  ...
'3.246E-6' '20.63';  ...
'3.2989E-6' '20.962';  ...
'3.3526999999999997E-6' '21.299';  ...
'3.4073999999999998E-6' '21.64';  ...
'3.4629E-6' '21.988';  ...
'3.5194E-6' '22.34';  ...
'3.5767999999999998E-6' '22.699';  ...
'3.6350999999999997E-6' '23.062';  ...
'3.6943999999999997E-6' '23.432';  ...
'3.7545999999999996E-6' '23.807';  ...
'3.8159E-6' '24.188';  ...
'3.878099999999999E-6' '24.575';  ...
'3.9413E-6' '24.967';  ...
'4.0056E-6' '25.366';  ...
'4.0708999999999994E-6' '25.771';  ...
'4.137299999999999E-6' '26.182';  ...
'4.204799999999999E-6' '26.6';  ...
'4.273299999999999E-6' '27.023';  ...
'4.343E-6' '27.454';  ...
'4.4138E-6' '27.89';  ...
'4.4858E-6' '28.334';  ...
'4.5589000000000005E-6' '28.784';  ...
'4.6333E-6' '29.241';  ...
'4.7088E-6' '29.705';  ...
'4.7855999999999995E-6' '30.176';  ...
'4.8637E-6' '30.653';  ...
'4.942999999999999E-6' '31.139';  ...
'5.0236E-6' '31.631';  ...
'5.1055E-6' '32.13';  ...
'5.188799999999999E-6' '32.637';  ...
'5.273399999999999E-6' '33.152';  ...
'5.3594E-6' '33.674';  ...
'5.446799999999999E-6' '34.204';  ...
'5.535599999999999E-6' '34.741';  ...
'5.6257999999999996E-6' '35.287';  ...
'5.7176E-6' '35.84';  ...
'5.8108E-6' '36.401';  ...
'5.9056E-6' '36.971';  ...
'6.0019E-6' '37.548';  ...
'6.0997E-6' '38.134';  ...
'6.1992E-6' '38.728'});
model.material('mat1').propertyGroup('RefractiveIndex').func('int2').set('interp', 'piecewisecubic');
model.material('mat1').propertyGroup('RefractiveIndex').func('int2').set('argunit', 'm');
model.material('mat1').propertyGroup('RefractiveIndex').func('int2').set('fununit', '1');
model.material('mat1').propertyGroup('RefractiveIndex').set('n', '');
model.material('mat1').propertyGroup('RefractiveIndex').set('ki', '');
model.material('mat1').propertyGroup('RefractiveIndex').set('n', {'n_interp(c_const/freq)' '0' '0' '0' 'n_interp(c_const/freq)' '0' '0' '0' 'n_interp(c_const/freq)'});
model.material('mat1').propertyGroup('RefractiveIndex').set('ki', {'k_interp(c_const/freq)' '0' '0' '0' 'k_interp(c_const/freq)' '0' '0' '0' 'k_interp(c_const/freq)'});
model.material('mat1').propertyGroup('RefractiveIndex').addInput('frequency');
model.material('mat1').set('family', 'plastic');
model.material.create('mat2', 'Common', 'comp1');
model.material('mat2').propertyGroup.create('RefractiveIndex', 'Refractive index');
model.material('mat2').propertyGroup('RefractiveIndex').func.create('int1', 'Interpolation');
model.material('mat2').propertyGroup('RefractiveIndex').func.create('int2', 'Interpolation');
model.material('mat2').label(['Air (Ciddor 1996: n 0.23-1.690 ' native2unicode(hex2dec({'00' 'b5'}), 'unicode') 'm)']);
model.material('mat2').set('groups', {'misc' 'Miscellaneous Materials'; 'mixed_gases' 'Mixed gases'});
model.material('mat2').propertyGroup('RefractiveIndex').func('int1').label('Refractive index');
model.material('mat2').propertyGroup('RefractiveIndex').func('int1').set('funcname', 'n_interp');
model.material('mat2').propertyGroup('RefractiveIndex').func('int1').set('table', {'2.3E-7' '1.0003080029552127';  ...
'2.446E-7' '1.0003030361805267';  ...
'2.592E-7' '1.0002991101754133';  ...
'2.738E-7' '1.0002959377270482';  ...
'2.8839999999999996E-7' '1.000293328638829';  ...
'3.03E-7' '1.0002911515320065';  ...
'3.176E-7' '1.0002893125810106';  ...
'3.3219999999999997E-7' '1.0002877429409882';  ...
'3.4679999999999996E-7' '1.0002863909482973';  ...
'3.6140000000000005E-7' '1.0002852170881296';  ...
'3.76E-7' '1.0002841906396';  ...
'3.9059999999999996E-7' '1.000283287376414';  ...
'4.052E-7' '1.0002824879531322';  ...
'4.198E-7' '1.0002817767490275';  ...
'4.3439999999999997E-7' '1.0002811410246588';  ...
'4.4899999999999996E-7' '1.0002805702966455';  ...
'4.636E-7' '1.0002800558675153';  ...
'4.782E-7' '1.000279590467587';  ...
'4.928E-7' '1.0002791679790022';  ...
'5.073999999999999E-7' '1.000278783220795';  ...
'5.22E-7' '1.0002784317798736';  ...
'5.366E-7' '1.0002781098769156';  ...
'5.512E-7' '1.0002778142590936';  ...
'5.657999999999999E-7' '1.0002775421136032';  ...
'5.804E-7' '1.0002772909974706';  ...
'5.949999999999999E-7' '1.000277058780197';  ...
'6.096E-7' '1.0002768435966023';  ...
'6.242E-7' '1.0002766438078328';  ...
'6.387999999999999E-7' '1.0002764579689447';  ...
'6.534E-7' '1.0002762848018152';  ...
'6.679999999999999E-7' '1.000276123172397';  ...
'6.825999999999999E-7' '1.000275972071535';  ...
'6.972E-7' '1.000275830598717';  ...
'7.118E-7' '1.0002756979482503';  ...
'7.264E-7' '1.0002755733974624';  ...
'7.41E-7' '1.000275456296587';  ...
'7.556E-7' '1.0002753460600669';  ...
'7.702E-7' '1.0002752421590502';  ...
'7.847999999999999E-7' '1.0002751441148945';  ...
'7.993999999999999E-7' '1.000275051493526';  ...
'8.14E-7' '1.0002749639005304';  ...
'8.286E-7' '1.000274880976863';  ...
'8.431999999999999E-7' '1.0002748023950938';  ...
'8.578E-7' '1.0002747278561126';  ...
'8.723999999999999E-7' '1.0002746570862278';  ...
'8.869999999999999E-7' '1.0002745898346075';  ...
'9.015999999999999E-7' '1.0002745258710195';  ...
'9.162E-7' '1.0002744649838253';  ...
'9.307999999999999E-7' '1.0002744069782015';  ...
'9.453999999999999E-7' '1.0002743516745563';  ...
'9.6E-7' '1.0002742989071178';  ...
'9.746E-7' '1.000274248522675';  ...
'9.892E-7' '1.0002742003794458';  ...
'1.0038E-6' '1.0002741543460703';  ...
'1.0183999999999999E-6' '1.000274110300699';  ...
'1.0329999999999999E-6' '1.0002740681301772';  ...
'1.0475999999999997E-6' '1.0002740277293098';  ...
'1.0622E-6' '1.000273989000196';  ...
'1.0768E-6' '1.0002739518516288';  ...
'1.0914E-6' '1.0002739161985537';  ...
'1.1059999999999999E-6' '1.0002738819615737';  ...
'1.1206E-6' '1.000273849066505';  ...
'1.1352E-6' '1.000273817443969';  ...
'1.1498000000000002E-6' '1.0002737870290228';  ...
'1.1644E-6' '1.000273757760824';  ...
'1.179E-6' '1.0002737295823214';  ...
'1.1935999999999999E-6' '1.0002737024399755';  ...
'1.2082E-6' '1.0002736762835016';  ...
'1.2228E-6' '1.000273651065634';  ...
'1.2373999999999998E-6' '1.0002736267419128';  ...
'1.252E-6' '1.0002736032704824';  ...
'1.2665999999999999E-6' '1.0002735806119147';  ...
'1.2812000000000001E-6' '1.0002735587290372';  ...
'1.2958E-6' '1.000273537586784';  ...
'1.3104E-6' '1.0002735171520498';  ...
'1.3249999999999998E-6' '1.0002734973935632';  ...
'1.3395999999999998E-6' '1.0002734782817637';  ...
'1.3542E-6' '1.0002734597886909';  ...
'1.3688E-6' '1.000273441887882';  ...
'1.3834E-6' '1.0002734245542761';  ...
'1.3979999999999998E-6' '1.0002734077641253';  ...
'1.4125999999999998E-6' '1.0002733914949142';  ...
'1.4271999999999999E-6' '1.0002733757252829';  ...
'1.4418E-6' '1.0002733604349563';  ...
'1.4564E-6' '1.000273345604679';  ...
'1.4709999999999998E-6' '1.000273331216155';  ...
'1.4856E-6' '1.0002733172519886';  ...
'1.5001999999999998E-6' '1.0002733036956346';  ...
'1.5147999999999999E-6' '1.0002732905313463';  ...
'1.5293999999999997E-6' '1.000273277744131';  ...
'1.544E-6' '1.000273265319707';  ...
'1.5585999999999998E-6' '1.0002732532444631';  ...
'1.5731999999999998E-6' '1.0002732415054205';  ...
'1.5878E-6' '1.0002732300902';  ...
'1.6024E-6' '1.000273218986986';  ...
'1.6169999999999997E-6' '1.0002732081844992';  ...
'1.6315999999999998E-6' '1.000273197671964';  ...
'1.6462E-6' '1.0002731874390856';  ...
'1.6607999999999998E-6' '1.0002731774760207';  ...
'1.6753999999999999E-6' '1.0002731677733576';  ...
'1.69E-6' '1.0002731583220907'});
model.material('mat2').propertyGroup('RefractiveIndex').func('int1').set('interp', 'piecewisecubic');
model.material('mat2').propertyGroup('RefractiveIndex').func('int1').set('argunit', 'm');
model.material('mat2').propertyGroup('RefractiveIndex').func('int1').set('fununit', '1');
model.material('mat2').propertyGroup('RefractiveIndex').func('int2').label('Refractive index, imaginary part');
model.material('mat2').propertyGroup('RefractiveIndex').func('int2').set('funcname', 'k_interp');
model.material('mat2').propertyGroup('RefractiveIndex').func('int2').set('table', {'2.3E-7' '0.0'; '9.6E-7' '0.0'; '1.69E-6' '0.0'});
model.material('mat2').propertyGroup('RefractiveIndex').func('int2').set('interp', 'piecewisecubic');
model.material('mat2').propertyGroup('RefractiveIndex').func('int2').set('argunit', 'm');
model.material('mat2').propertyGroup('RefractiveIndex').func('int2').set('fununit', '1');
model.material('mat2').propertyGroup('RefractiveIndex').set('n', '');
model.material('mat2').propertyGroup('RefractiveIndex').set('ki', '');
model.material('mat2').propertyGroup('RefractiveIndex').set('n', {'n_interp(c_const/freq)' '0' '0' '0' 'n_interp(c_const/freq)' '0' '0' '0' 'n_interp(c_const/freq)'});
model.material('mat2').propertyGroup('RefractiveIndex').set('ki', {'k_interp(c_const/freq)' '0' '0' '0' 'k_interp(c_const/freq)' '0' '0' '0' 'k_interp(c_const/freq)'});
model.material('mat2').propertyGroup('RefractiveIndex').addInput('frequency');
model.material('mat2').set('family', 'plastic');

model.physics('ewfd').label('LCP');
model.physics('ewfd2').label('RCP');
model.physics('ewfd').create('port1', 'Port', 2);
model.physics('ewfd').create('port2', 'Port', 2);
model.physics('ewfd').create('pc1', 'PeriodicCondition', 2);
model.physics('ewfd').create('pc2', 'PeriodicCondition', 2);
model.physics('ewfd').create('pc3', 'PeriodicCondition', 2);
model.physics('ewfd').create('pc4', 'PeriodicCondition', 2);
model.physics('ewfd2').create('port1', 'Port', 2);
model.physics('ewfd2').create('port2', 'Port', 2);
model.physics('ewfd2').create('pc1', 'PeriodicCondition', 2);
model.physics('ewfd2').create('pc2', 'PeriodicCondition', 2);
model.physics('ewfd2').create('pc3', 'PeriodicCondition', 2);
model.physics('ewfd2').create('pc4', 'PeriodicCondition', 2);
model.physics('ewfd').feature('port1').selection.set([9]);
model.physics('ewfd').feature('port1').set('PortType', 'Periodic');
model.physics('ewfd').feature('port1').set('PortExcitation', 'off');
model.physics('ewfd').feature('port1').set('PortSlit', true);
model.physics('ewfd').feature('port1').set('PortOrientation', 'ReversePort');
model.physics('ewfd').feature('port1').set('SlitType', 'DomainBacked');
model.physics('ewfd').feature('port1').set('Eampl', {'1' '1*i' '0'});
model.physics('ewfd').feature('port1').set('n', {'n_medium' '0' '0' '0' 'n_medium' '0' '0' '0' 'n_medium'});
model.physics('ewfd').feature('port2').selection.set([6]);
model.physics('ewfd').feature('port2').set('PortType', 'Periodic');
model.physics('ewfd').feature('port2').set('PortExcitation', 'on');
model.physics('ewfd').feature('port2').set('PortSlit', true);
model.physics('ewfd').feature('port2').set('PortOrientation', 'ReversePort');
model.physics('ewfd').feature('port2').set('SlitType', 'DomainBacked');
model.physics('ewfd').feature('port2').set('Eampl', {'1' '1*i' '0'});
model.physics('ewfd').feature('port2').set('n', {'n_medium' '0' '0' '0' 'n_medium' '0' '0' '0' 'n_medium'});
model.physics('ewfd2').feature('port1').selection.set([6]);
model.physics('ewfd2').feature('port1').set('PortType', 'Periodic');
model.physics('ewfd2').feature('port1').set('PortExcitation', 'off');
model.physics('ewfd2').feature('port1').set('PortSlit', true);
model.physics('ewfd2').feature('port1').set('PortOrientation', 'ReversePort');
model.physics('ewfd2').feature('port1').set('SlitType', 'DomainBacked');
model.physics('ewfd2').feature('port1').set('Eampl', {'1' '-1*i' '0'});
model.physics('ewfd2').feature('port1').set('n', {'n_medium' '0' '0' '0' 'n_medium' '0' '0' '0' 'n_medium'});
model.physics('ewfd2').feature('port2').selection.set([9]);
model.physics('ewfd2').feature('port2').set('PortType', 'Periodic');
model.physics('ewfd2').feature('port2').set('PortExcitation', 'on');
model.physics('ewfd2').feature('port2').set('PortSlit', true);
model.physics('ewfd2').feature('port2').set('SlitType', 'DomainBacked');
model.physics('ewfd2').feature('port2').set('PortOrientation', 'ReversePort');
model.physics('ewfd2').feature('port2').set('Eampl', {'1' '-1*i' '0'});
model.physics('ewfd2').feature('port2').set('n', {'n_medium' '0' '0' '0' 'n_medium' '0' '0' '0' 'n_medium'});
model.physics('ewfd').feature('pc1').selection.set([4 15]);
model.physics('ewfd').feature('pc1').set('PeriodicType', 'Floquet');
model.physics('ewfd').feature('pc1').set('Floquet_source', 'FromPeriodicPort');
model.physics('ewfd').feature('pc2').selection.set([5 12]);
model.physics('ewfd').feature('pc2').set('PeriodicType', 'Floquet');
model.physics('ewfd').feature('pc2').set('Floquet_source', 'FromPeriodicPort');
model.physics('ewfd').feature('pc3').selection.set([1 7 14 16]);
model.physics('ewfd').feature('pc3').set('PeriodicType', 'Floquet');
model.physics('ewfd').feature('pc3').set('Floquet_source', 'FromPeriodicPort');
model.physics('ewfd').feature('pc4').selection.set([2 8 11 13]);
model.physics('ewfd').feature('pc4').set('PeriodicType', 'Floquet');
model.physics('ewfd').feature('pc4').set('Floquet_source', 'FromPeriodicPort');
model.physics('ewfd2').feature('pc1').selection.set([4 15]);
model.physics('ewfd2').feature('pc1').set('PeriodicType', 'Floquet');
model.physics('ewfd2').feature('pc1').set('Floquet_source', 'FromPeriodicPort');
model.physics('ewfd2').feature('pc2').selection.set([5 12]);
model.physics('ewfd2').feature('pc2').set('PeriodicType', 'Floquet');
model.physics('ewfd2').feature('pc2').set('Floquet_source', 'FromPeriodicPort');
model.physics('ewfd2').feature('pc3').selection.set([1 7 14 16]);
model.physics('ewfd2').feature('pc3').set('PeriodicType', 'Floquet');
model.physics('ewfd2').feature('pc3').set('Floquet_source', 'FromPeriodicPort');
model.physics('ewfd2').feature('pc4').selection.set([2 8 11 13]);
model.physics('ewfd2').feature('pc4').set('PeriodicType', 'Floquet');
model.physics('ewfd2').feature('pc4').set('Floquet_source', 'FromPeriodicPort');

model.study('std1').create('param', 'Parametric');
model.study('std1').feature('param').setIndex('pname', 'lambda', 0);
model.study('std1').feature('param').setIndex('plistarr', '', 0);
model.study('std1').feature('param').setIndex('punit', 'm', 0);
model.study('std1').feature('param').setIndex('pname', 'lambda', 0);
model.study('std1').feature('param').setIndex('plistarr', '', 0);
model.study('std1').feature('param').setIndex('punit', 'm', 0);
model.study('std1').feature('param').setIndex('plistarr', 'range(500[nm],10[nm],2500[nm])', 0);


%blocks for volume integration
model.geom('geom1').create('blk1003', 'Block');
model.geom('geom1').feature('blk1003').set('size', {'blc' 'blc' 'hb*2'});
model.geom('geom1').feature('blk1003').set('base', 'center');
model.geom('geom1').feature('blk1003').set('pos', {'0' '0' '0'});
model.geom('geom1').create('blk1004', 'Block');
model.geom('geom1').feature('blk1004').set('size', {'blc' 'blc' 'hb*5'});
model.geom('geom1').feature('blk1004').set('base', 'center');
model.geom('geom1').feature('blk1004').set('pos', {'0' '0' '0'});
model.geom('geom1').create('blk1005', 'Block');
model.geom('geom1').feature('blk1005').set('size', {'blc' 'blc' 'hb*10'});
model.geom('geom1').feature('blk1005').set('pos', {'0' '0' '0'});
model.geom('geom1').feature('blk1005').set('base', 'center');
model.geom('geom1').create('blk1006', 'Block');
model.geom('geom1').feature('blk1006').set('size', {'blc' 'blc' 'hb*15'});
model.geom('geom1').feature('blk1006').set('base', 'center');
model.geom('geom1').feature('blk1006').set('pos', {'0' '0' '0'});
model.geom('geom1').create('blk1007', 'Block');
model.geom('geom1').feature('blk1007').set('size', {'blc' 'blc' 'hb*20'});
model.geom('geom1').feature('blk1007').set('base', 'center');
model.geom('geom1').feature('blk1007').set('pos', {'0' '0' '0'});
model.geom('geom1').run('blk1007');


%gammadion base
model.geom('geom1').create('blkgb1', 'Block');
model.geom('geom1').feature('blkgb1').set('size', {'wb*9' 'wb*3' 'hb'});
model.geom('geom1').feature('blkgb1').set('base', 'center');
model.geom('geom1').feature('blkgb1').set('pos', {'wb*3' 'wb*6' '0'});
model.geom('geom1').runPre('fin');
model.geom('geom1').create('blkgb2', 'Block');
model.geom('geom1').feature('blkgb2').set('size', {'wb*9' 'wb*3' 'hb'});
model.geom('geom1').feature('blkgb2').set('base', 'center');
model.geom('geom1').feature('blkgb2').set('pos', {'wb*-3' 'wb*-6' '0'});
model.geom('geom1').runPre('fin');
model.geom('geom1').create('blkgb3', 'Block');
model.geom('geom1').feature('blkgb3').set('size', {'wb*3' 'wb*9' 'hb'});
model.geom('geom1').feature('blkgb3').set('base', 'center');
model.geom('geom1').feature('blkgb3').set('pos', {'wb*-6' 'wb*3' '0'});
model.geom('geom1').runPre('fin');
model.geom('geom1').create('blkgb4', 'Block');
model.geom('geom1').feature('blkgb4').set('size', {'wb*3' 'wb*9' 'hb'});
model.geom('geom1').feature('blkgb4').set('base', 'center');
model.geom('geom1').feature('blkgb4').set('pos', {'wb*6' 'wb*-3' '0'});
model.geom('geom1').runPre('fin');
model.geom('geom1').create('blkgb5', 'Block');
model.geom('geom1').feature('blkgb5').set('size', {'wb*3' 'wb*9' 'hb'});
model.geom('geom1').feature('blkgb5').set('base', 'center');
model.geom('geom1').feature('blkgb5').set('pos', {'0' '0' '0'});
model.geom('geom1').runPre('fin');
model.geom('geom1').create('blkgb6', 'Block');
model.geom('geom1').feature('blkgb6').set('size', {'wb*9' 'wb*3' 'hb'});
model.geom('geom1').feature('blkgb6').set('base', 'center');
model.geom('geom1').feature('blkgb6').set('pos', {'0' '0' '0'});
model.geom('geom1').runPre('fin');

%counter for building up new structures in loop
global counter namecell
counter=7;

%plane representation of the current structure
%start by adding in rectangles above
planeRep = zeros(21);
planeRep(10:18,4:6) = 2;
planeRep(4:6,4:12) = 2;
planeRep(4:12,16:18) = 2;
planeRep(16:18,10:18) = 2;
planeRep(10:12,7:15) = 2;
planeRep(7:15,10:12) = 2;
planeRep = available(planeRep);

numLays=2;
addProb = 0.2;

figure(1);clf;
subplot(1,numLays+1,1)
prplot = planeRep;
prplot(planeRep==1)=0;
imshow(prplot./2)
title('Initial Gammadion')
namecell = {'blkgb1','blkgb2','blkgb3','blkgb4','blkgb5','blkgb6'};
for k = 1:numLays
[planeRep,model,namecell,counter] = addLayer(planeRep,addProb,model,namecell,counter);
planeRep = available(planeRep);
figure(1);
subplot(1,numLays+1,k+1)
prplot = planeRep;
prplot(planeRep==1)=0;
imshow(prplot./2)
title(strcat('Gammadion, Iteration:',num2str(k)))
end

print(gcf,strcat(dr,'structure',num2str(st),'.png'),'-dpng','-r300')
dlmwrite(strcat(dr,'structure',num2str(st),'.csv'),planeRep)

%union the gammadion
model.geom('geom1').create('uni1', 'Union');
model.geom('geom1').feature('uni1').selection('input').set(namecell);
model.geom('geom1').feature('uni1').label('gammadionAll');
model.geom('geom1').feature('uni1').set('intbnd', false);
model.geom('geom1').run('uni1');
model.geom('geom1').runPre('fin');

%run the entire geometry - Fingers Crossed!!!
model.geom('geom1').run;

model.material('mat1').selection.set([14]);
model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13]);
try
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15]);
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15 16]);
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15 16 17]);
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15 16 17 18]);
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15 16 17 18 19]);
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15 16 17 18 19 20]);
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15 16 17 18 19 20 21]);
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15 16 17 18 19 20 21 22]);
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15 16 17 18 19 20 21 22 23]);
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15 16 17 18 19 20 21 22 23 24]);
    model.material('mat2').selection.set([1 2 3 4 5 6 7 8 9 10 11 12 13 15 16 17 18 19 20 21 22 23 24 25]);
end

%run the entire geometry - Fingers Crossed!!!
model.geom('geom1').run;

%print the structure to figure
figure(2)
mphgeom(model,'geom1','facealpha',0.5)

model.geom('geom1').run('fin');

model.mesh('mesh1').automatic(true);
model.mesh('mesh1').autoMeshSize(6);

model.geom('geom1').feature('blk1003').active(false);
model.geom('geom1').feature('blk1004').active(false);
model.geom('geom1').feature('blk1005').active(false);
model.geom('geom1').feature('blk1006').active(false);
model.geom('geom1').feature('blk1007').active(false);
model.geom('geom1').runPre('fin');
model.geom('geom1').run;

model.mesh('mesh1').run;

model.geom('geom1').feature('blk1007').active(true);
model.geom('geom1').runPre('fin');
model.geom('geom1').run;

model.mesh('mesh1').run;

model.geom('geom1').feature('blk1006').active(true);
model.geom('geom1').runPre('fin');
model.geom('geom1').run;

model.mesh('mesh1').run;

model.geom('geom1').feature('blk1005').active(true);
model.geom('geom1').runPre('fin');
model.geom('geom1').run;

model.mesh('mesh1').run;

model.geom('geom1').feature('blk1004').active(true);
model.geom('geom1').runPre('fin');
model.geom('geom1').run;

model.mesh('mesh1').run;

model.geom('geom1').feature('blk1003').active(true);
model.geom('geom1').runPre('fin');
model.geom('geom1').run;

model.mesh('mesh1').run;

model.sol.create('sol1');
model.sol('sol1').study('std1');

model.study('std1').feature('freq').set('notlistsolnum', 1);
model.study('std1').feature('freq').set('notsolnum', 'auto');
model.study('std1').feature('freq').set('listsolnum', 1);
model.study('std1').feature('freq').set('solnum', 'auto');
model.study('std1').feature('param').set('sweeptype', 'filled');
model.study('std1').feature('freq').set('punit', 'GHz');
model.study('std1').feature('freq').set('plist', 'frequency');

model.sol('sol1').create('st1', 'StudyStep');
model.sol('sol1').feature('st1').set('study', 'std1');
model.sol('sol1').feature('st1').set('studystep', 'freq');
model.sol('sol1').create('v1', 'Variables');
model.sol('sol1').feature('v1').set('control', 'freq');
model.sol('sol1').create('s1', 'Stationary');
model.sol('sol1').feature('s1').set('stol', 0.01);
model.sol('sol1').feature('s1').create('p1', 'Parametric');
model.sol('sol1').feature('s1').feature.remove('pDef');
model.sol('sol1').feature('s1').feature('p1').set('pname', {'freq'});
model.sol('sol1').feature('s1').feature('p1').set('plistarr', {'frequency'});
model.sol('sol1').feature('s1').feature('p1').set('punit', {'GHz'});
model.sol('sol1').feature('s1').feature('p1').set('pcontinuationmode', 'no');
model.sol('sol1').feature('s1').feature('p1').set('preusesol', 'auto');
model.sol('sol1').feature('s1').feature('p1').set('pdistrib', 'off');
model.sol('sol1').feature('s1').feature('p1').set('plot', 'off');
model.sol('sol1').feature('s1').feature('p1').set('plotgroup', 'Default');
model.sol('sol1').feature('s1').feature('p1').set('probesel', 'all');
model.sol('sol1').feature('s1').feature('p1').set('probes', {});
model.sol('sol1').feature('s1').feature('p1').set('control', 'freq');
model.sol('sol1').feature('s1').set('control', 'freq');
model.sol('sol1').feature('s1').feature('aDef').set('complexfun', true);
model.sol('sol1').feature('s1').create('fc1', 'FullyCoupled');
model.sol('sol1').feature('s1').create('d1', 'Direct');
model.sol('sol1').feature('s1').feature('d1').set('linsolver', 'mumps');
model.sol('sol1').feature('s1').feature('d1').label('Suggested Direct Solver (ewfd)');
model.sol('sol1').feature('s1').feature('fc1').set('linsolver', 'd1');
model.sol('sol1').feature('s1').feature.remove('fcDef');
model.sol('sol1').attach('std1');

%run everything
model.sol('sol1').runAll;

model.batch.create('p1', 'Parametric');
model.batch('p1').study('std1');
model.batch('p1').create('so1', 'Solutionseq');
model.batch('p1').feature('so1').set('seq', 'sol1');
model.batch('p1').feature('so1').set('store', 'on');
model.batch('p1').feature('so1').set('clear', 'on');
model.batch('p1').feature('so1').set('psol', 'none');
model.batch('p1').set('pname', {'lambda'});
model.batch('p1').set('plistarr', {'range(500[nm],10[nm],2500[nm])'});
model.batch('p1').set('sweeptype', 'sparse');
model.batch('p1').set('probesel', 'all');
model.batch('p1').set('probes', {});
model.batch('p1').set('plot', 'off');
model.batch('p1').set('err', 'on');
model.batch('p1').attach('std1');
model.batch('p1').set('control', 'param');

model.sol.create('sol2');
model.sol('sol2').study('std1');
model.sol('sol2').label('Parametric Solutions 1');

model.batch('p1').feature('so1').set('psol', 'sol2');

model.batch('p1').run;

model.result.dataset.create('cpl1', 'CutPlane');
model.result.dataset.create('cpl2', 'CutPlane');
model.result.dataset.create('cpl3', 'CutPlane');
model.result.dataset.create('cpl4', 'CutPlane');
model.result.dataset('cpl1').set('quickplane', 'xy');
model.result.dataset('cpl2').set('quickplane', 'xy');
model.result.dataset('cpl3').set('quickplane', 'xy');
model.result.dataset('cpl4').set('quickplane', 'xy');
model.result.dataset('cpl1').set('quickz', 'hb/2');
model.result.dataset('cpl2').set('quickz', 'hb*6/2');
model.result.dataset('cpl3').set('quickz', '-hb/2');
model.result.dataset('cpl4').set('quickz', '-hb*6/2');
model.result.dataset('cpl1').set('data', 'dset2');
model.result.dataset('cpl2').set('data', 'dset2');
model.result.dataset('cpl3').set('data', 'dset2');
model.result.dataset('cpl4').set('data', 'dset2');

model.result.create('pg5', 'PlotGroup2D');
model.result('pg5').create('surf1', 'Surface');
model.result('pg5').feature('surf1').set('expr', 'C_CPL/C0');
model.result('pg5').feature('surf1').set('data', 'cpl1');
model.result('pg5').create('surf2', 'Surface');
model.result('pg5').feature('surf2').set('expr', 'C_CPL/C0');
model.result('pg5').feature('surf2').set('data', 'cpl2');
model.result('pg5').create('surf3', 'Surface');
model.result('pg5').feature('surf3').set('expr', 'C_CPL/C0');
model.result('pg5').feature('surf3').set('data', 'cpl3');
model.result('pg5').create('surf4', 'Surface');
model.result('pg5').feature('surf4').set('expr', 'C_CPL/C0');
model.result('pg5').feature('surf4').set('data', 'cpl4');

model.result.numerical.create('gev1', 'EvalGlobal');
model.result.numerical('gev1').setIndex('expr', 'ewfd.Atotal', 0);
model.result.numerical('gev1').setIndex('expr', 'ewfd.Rtotal', 1);
model.result.numerical('gev1').setIndex('expr', 'ewfd.Ttotal', 2);
model.result.numerical('gev1').set('data', 'dset2');

model.result('pg5').run;

model.result.export.create('data1', 'Data');
model.result.export('data1').set('data', 'dset2');

model.label(strcat('basemodel',num2str(st),'.mph'));

mphsave(model,strcat(dr,'basemodel',num2str(st),'.mph'))

out = 1;
